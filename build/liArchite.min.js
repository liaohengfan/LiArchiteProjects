function getIconUrlByType(e){var t=_.findWhere(ICON_TYPE_CHECK,{type:e});return t?ICON_ASSET_BASE+t.ico:""}function getPositionByLonLat(e,t,i){var n=new THREE.Vector3;return n.x=i*Math.sin(e)*Math.sin(t),n.y=i*Math.cos(e),n.z=i*Math.sin(e)*Math.cos(t),n}function Rect(e,t,i,n){this.tl=[e||0,t||0],this.br=[i||0,n||0]}function updateBillBoards(e,t){for(var i=Number(V_WIDTH>>1),n=Number(V_HEIGHT>>1),o=0;o<e.children.length;o++){var a=e.children[o],r=new THREE.Vector3(a.lockX,a.lockZ,-a.lockY);r.applyProjection(t);var s=Math.round(r.x*i),l=Math.round(r.y*n),c=Math.round(r.z*n);a.position.set(s,l,c);for(var h=!0,u=5,p=0;p<o;p++){var d=a.material.map.image;if(!d){h=!1;break}if(!a.width||!a.height){h=!1;break}var f=a.width/2,m=a.height/2,y=new Rect(a.position.x-f,a.position.y-m,a.position.x+m,a.position.y+m),b=e.children[p],g=b.position,v=b.width/2,w=b.height/2,E=new Rect(g.x-v,g.y-w,g.x+w,g.y+w);if(b.visible&&y.isCollide(E)){h=!1;break}if(y.tl[0]-=u,y.tl[1]-=u,E.tl[0]-=u,E.tl[1]-=u,0==a.visible&&y.isCollide(E)){h=!1;break}}a.visible=h}}function parseVec2Points(e){for(var t=[],i=0;i<e.length;i+=2){var n=new THREE.Vector2(e[i],e[i+1]);if(i>0){var o=t[t.length-1];n.x==o.x&&n.y==o.y||t.push(n)}else t.push(n)}return t}function getLabelTexture(e){var t=document.createElement("canvas"),i=t.getContext("2d");i.strokeStyle="#FFFFFF",i.fillStyle="#000000",i.lineWidth=4,i.font="32px Microsoft Yahei",i.fillText(e,10,40);var n=new THREE.Texture(t);return n}function imageAddBorderTexture(e){var t=document.createElement("canvas");document.body.appendChild(t);var i=t.getContext("2d");i.drawImage(e,0,0);var n=new THREE.Texture(t);return n}function getDataMesh(e,t,i){void 0===t&&(t=1),void 0===i&&(i=16777215);var n={outline3D:new THREE.Object3D,outline2D:new THREE.Object3D};if(e=e||{},e.Outline=e.Outline||[],e.Outline)for(var o={amount:10,bevelEnabled:!1,curveSegments:1,steps:1},a=0;a<e.Outline.length;a++){var r=e.Outline[a];r=r||[];for(var s=0;s<r.length;s++){var l=parseVec2Points(r[s]),c=new THREE.Shape(l),h=new THREE.ShapeGeometry(c),u=new THREE.MeshBasicMaterial({color:i||16777215}),p=new THREE.Mesh(h,u);p.defaultMaterial=u,p.selMaterial=null,o.amount=10*(e.High||t);var d=new THREE.ExtrudeGeometry(c,o),f=new THREE.MeshLambertMaterial({color:i||16777215,side:THREE.DoubleSide}),m=new THREE.Mesh(d,f);m.defaultMaterial=f,m.selMaterial=null,i+=1,n.outline3D.add(m),n.outline2D.add(p)}}return n}function getLimitHeightDataMesh(e,t,i){void 0===t&&(t=1),void 0===i&&(i=16777215);var n={outline3D:new THREE.Object3D,outline2D:new THREE.Object3D};if(e=e||{},e.Outline=e.Outline||[],e.Outline)for(var o={amount:10,bevelEnabled:!1,curveSegments:1,steps:1},a=0;a<e.Outline.length;a++){var r=e.Outline[a];r=r||[];for(var s=0;s<r.length;s++){var l=parseVec2Points(r[s]),c=new THREE.Shape(l),h=new THREE.ShapeGeometry(c),u=new THREE.MeshBasicMaterial({color:i||16777215}),p=new THREE.Mesh(h,u);p.defaultMaterial=u,o.amount=10*t;var d=new THREE.MeshLambertMaterial({color:i||16777215}),f=new THREE.ExtrudeGeometry(c,o),m=new THREE.Mesh(f,d);m.defaultMaterial=d,i+=1,n.outline3D.add(m),n.outline2D.add(p)}}return n}function meshChangeOpacity(e,t){function i(e){if(e&&"Mesh"==e.type&&e.defaultMaterial&&(e.defaultMaterial.transparent=n,e.defaultMaterial.opacity=t),e&&"Sprite"==e.type&&e.defaultMaterial&&(e.defaultMaterial.transparent=n,e.defaultMaterial.opacity=t),e.children&&e.children.length)for(var o=0;o<e.children.length;o++){var a=e.children[o];i(a)}}t=t||1;var n=!0;t>=1&&(n=!1),e&&i(e)}var ArchiteBase=function(){function e(e,t){this.archite_show=!0,this.archite_name="",this.archite_id="",this.is3D=!0,this.showall=!1,this.oriData=null,this.ArchiteName="",this.ArchiteOutLine=[],this.ArchiteID="",this.ArchiteMesh=null,this.ArchiteMesh2D=null,this.floorGround=null,this.floorGround2D=null,this.ArchiteSprite=null,this.ArchiteIcon=null,this.ArchiteLabel=null,this.architeFloors=[],this.buildingOutLine=null,this.buildingOutLineShow=!1,this.pubPointShow=!0,this.funcareaLabelShow=!0,this.oriData=e,this.ArchiteName=this.oriData.building.Name,this.ArchiteOutLine=this.oriData.building.Outline,this.ArchiteID=this.oriData.building._id,this.archite_id=e._id,this.archite_name=e.Name,this.is3D=t,this.oriData.Floors=this.oriData.Floors||[],this.floorGround=new THREE.Object3D,this.floorGround2D=new THREE.Object3D,this.ArchiteMesh=new THREE.Object3D,this.ArchiteMesh2D=new THREE.Object3D,this.ArchiteSprite=new THREE.Object3D,this.ArchiteIcon=new THREE.Object3D,this.ArchiteLabel=new THREE.Object3D,this.ArchiteSprite.add(this.ArchiteIcon),this.ArchiteSprite.add(this.ArchiteLabel),this.floorGround.rotateX(-(Math.PI/2)),this.floorGround2D.rotateX(-(Math.PI/2)),this.ArchiteMesh.rotateX(-(Math.PI/2)),this.ArchiteMesh2D.rotateX(-(Math.PI/2))}return e.prototype.parseBuildingOutLine=function(){this.buildingOutLine=getDataMesh(this.oriData.building).outline3D,this.buildingOutLine.visible=this.buildingOutLineShow,this.ArchiteMesh.add(this.buildingOutLine)},e.prototype.enabledBuildingOutLine=function(e){this.buildingOutLine.visible=e,this.buildingOutLineShow=e},e.prototype.getDefaultFoolr=function(){return this.oriData.building.DefaultFloor},e.prototype.getFloorY=function(e){var t=null,i=0;return e>0?(t=_.filter(this.oriData.Floors,function(t){return t._id<e&&t._id>=0}),_.map(t,function(e){i+=e.High||0}),i):(t=_.filter(this.oriData.Floors,function(t){return t._id>=e&&t._id<=0}),_.map(t,function(e){i-=e.High||0}),i)},e.prototype.enabeld3D=function(e){this.is3D=e,_.map(this.architeFloors,function(t){t.is3D=e})},e.prototype.display2DPattern=function(){var e=this,t=_.filter(e.architeFloors,function(e){return 1==e.showStuts}),i=_.filter(e.architeFloors,function(e){return 2==e.showStuts});if(t.length){t=_.sortBy(t,function(e){return e._id||-100});var n=_.first(t);try{n.stutsChange(1)}catch(e){}var o=_.rest(t);_.map(o,function(e){try{e.stutsChange(0)}catch(e){}}),_.map(i||[],function(e){try{e.stutsChange(0)}catch(e){}})}},e.prototype.showFloorsMeshByID=function(e,t){void 0===t&&(t=!1);var i=null;i=_.findWhere(this.architeFloors,{archite_id:e});var n=null;if(n=_.reject(this.architeFloors,function(t){return t.archite_id==e}),n&&n.length)for(var o=0;o<n.length;o++){var a=n[o];a&&(t?a.stutsChange(0):a.stutsChange(2))}if(i)i.stutsChange(1);else{if(i=this.createFloors(e),!i)return;this.architeFloors.push(i),this.ArchiteMesh.add(i.getFuncAreasMesh(!0)),this.ArchiteMesh2D.add(i.getFuncAreasMesh(!1)),this.floorGround.add(i.getFloorGround(!0)),this.floorGround2D.add(i.getFloorGround(!1)),this.ArchiteIcon.add(i.getPubPoints(this.pubPointShow)),this.ArchiteIcon.add(i.getFuncAreasLabel(this.funcareaLabelShow))}return i},e.prototype.search=function(e){var t=_.filter(this.oriData.Floors||[],function(t){return!!_.findWhere(t.FuncAreas||[],{Name:e})});if(!t||!t.length)return null;var i=t[0],n=this.showFloorsMeshByID(i._id);if(!n)return null;var o=n.searchFuncArea(e);return o?o:null},e.prototype.showAllFloors=function(){var e=this;_.map(e.oriData.Floors||[],function(t,i){var n=_.findWhere(e.architeFloors,{archite_id:t._id});if(n);else{if(n=e.createFloors(t._id),!n)return;e.architeFloors.push(n),e.ArchiteMesh.add(n.getFuncAreasMesh(!0)),e.ArchiteMesh2D.add(n.getFuncAreasMesh(!1)),e.floorGround.add(n.getFloorGround(!0)),e.floorGround2D.add(n.getFloorGround(!1)),e.ArchiteIcon.add(n.getPubPoints(e.pubPointShow)),e.ArchiteIcon.add(n.getFuncAreasLabel(e.funcareaLabelShow))}0==i?n.stutsChange(1):n.stutsChange(2)})},e.prototype.updateBillBoards=function(e){if(e&&(this.pubPointShow||this.funcareaLabelShow)){var t=new THREE.Matrix4;t.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);for(var i=0;i<this.architeFloors.length;i++){var n=this.architeFloors[i];0!=n.showStuts&&(this.pubPointShow&&n.updateSpritesPosition(t),this.funcareaLabelShow&&n.updateLabelsPosition(t))}}},e.prototype.enabledFloorsPubPoints=function(e){this.pubPointShow=e;for(var t=_.where(this.architeFloors,{archite_show:!0}),i=0;i<t.length;i++){var n=t[i];this.ArchiteIcon.add(n.getPubPoints(e))}},e.prototype.enabledFloorsLabel=function(e){this.funcareaLabelShow=e;for(var t=_.where(this.architeFloors,{archite_show:!0}),i=0;i<t.length;i++){var n=t[i];this.ArchiteIcon.add(n.getFuncAreasLabel(e))}},e.prototype.createFloors=function(e){var t=null;if(t=_.findWhere(this.oriData.Floors||[],{_id:e})){var i=this.getFloorY(e),n=new ArchiteFloor(t,80*i);return n}},e}(),ArchiteData=function(){function e(e,t){this.ui=null,this.webgl=null,this.is3D=!0,this.ui=e,this.webgl=t}return e.prototype.getMapsbyAjax=function(e,t){var i=this;$.ajax({type:"GET",url:e,dataType:"json",data:t,success:function(e){i.parseMapsData(e)}})},e.prototype.parseMapsData=function(e){var t=new ArchiteBase(e.data,this.is3D);this.webgl.updateMapByArchiteBase(t),this.ui.updataUIByArchiteBase(t)},e}(),ArchiteFuncArea=function(){function e(e,t,i){this.archite_show=!0,this.archite_name="",this.archite_id="",this.mesh=null,this.plane=null,this.archite_id=e._id,this.archite_name=e.Name;var n=getDataMesh(e,t,i);this.mesh=n.outline3D,this.plane=n.outline2D}return e}(),ArchiteFloor=function(){function e(e,t){this.showStuts=1,this.archite_show=!0,this.archite_name="",this.archite_id="",this.floorData=null,this.is3D=!0,this.yAxis=0,this.floorHigh=0,this.PubPoints=null,this.floorGround=null,this.floorGround2D=null,this.funcAreas=[],this.funcAreaMesh=null,this.funcAreaMesh2D=null,this.funcAreasLabels=null,this.floorData=e,this.archite_id=e._id,this.archite_name=e.Name,this.yAxis=t,this.floorHigh=10*e.High}return e.prototype.applyStuts=function(e,t,i){e&&(e.visible=t,t&&meshChangeOpacity(e,i))},e.prototype.updateLabelsPosition=function(e){this.funcAreasLabels&&updateBillBoards(this.funcAreasLabels,e)},e.prototype.updateSpritesPosition=function(e){this.PubPoints&&updateBillBoards(this.PubPoints,e)},e.prototype.stutsChange=function(e){if(e!=this.showStuts)switch(this.showStuts=e,this.showStuts){case 1:this.applyStuts(this.floorGround,!0,1),this.applyStuts(this.funcAreaMesh,!0,1),this.applyStuts(this.floorGround2D,!0,1),this.applyStuts(this.funcAreaMesh2D,!0,1),this.applyStuts(this.PubPoints,!0,1),this.applyStuts(this.funcAreasLabels,!0,1);break;case 2:this.applyStuts(this.floorGround,!0,.1),this.applyStuts(this.funcAreaMesh,!0,.1),this.applyStuts(this.floorGround2D,!0,.1),this.applyStuts(this.funcAreaMesh2D,!0,.1),this.applyStuts(this.PubPoints,!0,.1),this.applyStuts(this.funcAreasLabels,!0,.1);break;default:this.applyStuts(this.floorGround,!1,.1),this.applyStuts(this.funcAreaMesh,!1,.1),this.applyStuts(this.floorGround2D,!1,.1),this.applyStuts(this.funcAreaMesh2D,!1,.1),this.applyStuts(this.PubPoints,!1,.1),this.applyStuts(this.funcAreasLabels,!1,.1)}},e.prototype.getPubPoints=function(e){if(this.PubPoints)return this.PubPoints.visible=e,this.PubPoints;if(this.PubPoints=new THREE.Object3D,this.PubPoints.position.z=this.yAxis,this.PubPoints.visible=e,this.floorData.PubPoint){this.floorData.PubPoint=this.floorData.PubPoint||[];var t=this.floorData.High;t*=10;for(var i=this.yAxis+t,n=0;n<this.floorData.PubPoint.length;n++){var o=this.floorData.PubPoint[n],a=o.Outline[0][0],r=new THREE.Vector3(a[0]||0,a[1],t),s=getIconUrlByType(o.Type),l=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(s),color:16777215}),c=new THREE.Sprite(l);c.lockX=r.x,c.lockY=r.y,c.lockZ=i,c.defaultMaterial=l,c.scale.set(24,24,1),c.width=24,c.height=24,c.position.copy(r),this.PubPoints.add(c)}}return this.PubPoints},e.prototype.getFloorGround=function(e){if(void 0===e&&(e=!0),this.floorGround)return e?this.floorGround:this.floorGround2D;if(this.floorGround=new THREE.Object3D,this.floorGround.position.z=this.yAxis-10,this.floorGround2D=new THREE.Object3D,this.floorGround2D.position.z=this.yAxis+this.floorHigh-1,this.floorData.Outline){var t=getLimitHeightDataMesh(this.floorData,1,16777215);this.floorGround.add(t.outline3D),this.floorGround2D.add(t.outline2D)}return e?this.floorGround:this.floorGround2D},e.prototype.getFuncAreasMesh=function(e){if(this.funcAreaMesh)return e?this.funcAreaMesh:this.funcAreaMesh2D;if(this.funcAreaMesh=new THREE.Object3D,this.funcAreaMesh.position.z=this.yAxis,this.funcAreaMesh2D=new THREE.Object3D,this.funcAreaMesh2D.position.z=this.yAxis+this.floorHigh,this.floorData.FuncAreas)for(var t=this.floorData.FuncAreas,i=this.floorData.High,n=0;n<t.length;n++){var o=[13237193,9947643,13224443],a=_.sample(o),r=new ArchiteFuncArea(t[n],i,a);this.funcAreaMesh.add(r.mesh),this.funcAreaMesh2D.add(r.plane),this.funcAreas.push(r)}return e?this.funcAreaMesh:this.funcAreaMesh2D},e.prototype.searchFuncArea=function(e){var t=_.findWhere(this.funcAreas,{archite_name:e});return t},e.prototype.getFuncAreasLabel=function(e){if(this.funcAreasLabels)return this.funcAreasLabels.visible=e,this.funcAreasLabels;if(this.funcAreasLabels=new THREE.Object3D,this.funcAreasLabels.position.z=this.yAxis,this.funcAreasLabels.visible=e,this.floorData.FuncAreas){this.floorData.FuncAreas=this.floorData.FuncAreas||[];var t=this.floorData.High;t*=10;for(var i=this.yAxis+t,n=0;n<this.floorData.FuncAreas.length;n++){var o=this.floorData.FuncAreas[n],a=o.Center,r=new THREE.Vector3(a[0]||0,a[1],t),s=new THREE.SpriteMaterial({map:getLabelTexture(o.Name||" "),color:16777215});s.map.needsUpdate=!0;var l=new THREE.Sprite(s);l.lockX=r.x,l.lockY=r.y,l.lockZ=i,l.width=50,l.height=25,l.defaultMaterial=s,l.scale.set(100,50,1),l.position.copy(r),this.funcAreasLabels.add(l)}}return this.funcAreasLabels},e}(),V_WIDTH=1280,V_HEIGHT=720,FOR=60,NEAR=10,FAER=1e4,PI2=2*Math.PI,ICON_ASSET_BASE="asset/PublicPointIco/",ICON_TYPE_CHECK=[{name:"ATM",type:"31003",ico:"ATM.png",en:""},{name:"残障洗手间",type:"11005",ico:"crippled.png",en:""},{name:"出入口",type:"31004",ico:"entry.png",en:""},{name:"扶梯",type:"21002",ico:"escalator.png",en:""},{name:"女洗手间",type:"11003",ico:"Female.png",en:""},{name:"问讯处",type:"31001",ico:"inquiry.png",en:""},{name:"直梯",type:"21003",ico:"lift.png",en:""},{name:"补妆间",type:"31002",ico:"Makeup.png",en:""},{name:"男洗手间",type:"11002",ico:"Male.png",en:""},{name:"母婴室",type:"11004",ico:"MomBaby.png",en:""},{name:"楼梯",type:"21001",ico:"stair.png",en:""},{name:"洗手间",type:"11001",ico:"toilet.png",en:""}],IsPC=function(){for(var e=navigator.userAgent,t=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),i=!0,n=0;n<t.length;n++)if(e.indexOf(t[n])>0){i=!1;break}return i},msg=function(e){layer?layer.msg(e):alert(e)},ArchiteMain=function(){function e(e,t){if(!Detector.webgl)throw msg("该浏览器不支持webgl / Canvas, 请更换浏览器后尝试！"),new Error("该浏览器不支持webgl / Canvas, 请更换浏览器后尝试！");this.architewebgl=new ArchiteWebGL(e,t)}return e.prototype.render=function(){TWEEN.update(),this.architewebgl.render()},e.prototype.windowResize=function(e,t){V_WIDTH=e,V_HEIGHT=t,this.architewebgl.resize()},e}(),ArchiteWebGL=function(){function e(e,t){this.domContainer=null,this.controlDom=null,this.renderer=null,this.camera=null,this.scene=null,this.curArchite=null,this.defalutCameraPosition=new THREE.Vector3(0,0,0),this.curCameraPosition=new THREE.Vector3(0,0,0),this.defalutCameraTween=null,this.maxPolarAngleInit=Math.PI/2,this.perspectiveControlSet={minPolarAngle:0,maxPolarAngle:Math.PI/2},this.perspectiveControl=null,this.cameraControls=[],this.planeScene=null,this.is3D=!0,this.labelScene=null,this.labelCamera=null,this.lookatTween=null,this.lookatVector3=new THREE.Vector3(0,0,0),this.selectEnabled=!0,this.raycaster=null,this.meshSelDownPoint=new THREE.Vector2(0,0),this.isSel=!0,this.SelMesh=null,this.SelMaterial=new THREE.MeshLambertMaterial({color:16776960,emissing:0,transparent:!0,opacity:1}),this.SelEffectTweenAlpha1=null,this.SelEffectTweenAlpha0=null,this.SelPlane=null,this.SelMaterialPlane=new THREE.MeshBasicMaterial({color:16776960,transparent:!0,opacity:1}),this.SelEffectTweenAlphaPlane1=null,this.SelEffectTweenAlphaPlane0=null,this.mousePoint=new THREE.Vector2(0,0),this.domContainer=e,this.controlDom=t,this.init()}return e.prototype.init=function(){Detector.webgl?this.renderer=new THREE.WebGLRenderer({antialias:!0}):this.renderer=new THREE.CanvasRenderer,this.lookatTween=new TWEEN.Tween(this.lookatVector3),this.scene=new THREE.Scene,this.planeScene=new THREE.Scene,this.labelScene=new THREE.Scene,this.createPerspective(),this.defalutCameraTween=new TWEEN.Tween(this.curCameraPosition),this.perspectiveTween=new TWEEN.Tween(this.perspectiveControlSet),this.createOrthographic(),this.createLights(),this.createMeshSel(),this.renderer.setClearColor(15856375),this.renderer.setSize(V_WIDTH,V_HEIGHT),this.renderer.autoClear=!1,this.domContainer.appendChild(this.renderer.domElement)},e.prototype.lookatYTweento=function(e){var t=this;t.is3D&&(t.lookatVector3.copy(t.perspectiveControl.target),t.lookatTween.to({y:e},500).onUpdate(function(e){t.perspectiveControl.target.copy(this),t.perspectiveControl.update()}),t.lookatTween.start())},e.prototype.createOrthographic=function(){this.labelCamera=new THREE.OrthographicCamera(V_WIDTH/-2,V_WIDTH/2,V_HEIGHT/2,V_HEIGHT/-2,-FAER,2*FAER),this.labelCamera.position.z=10},e.prototype.createPerspective=function(){this.camera=new THREE.PerspectiveCamera(FOR,V_WIDTH/V_HEIGHT,NEAR,FAER),this.camera.up.set(0,1,0),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.camera.position.z=1200;var e=new THREE.OrbitControls(this.camera,this.controlDom);e.maxPolarAngle=Math.PI/2,e.minPolarAngle=0,e.minDistance=20,e.minDistance=100,e.maxDistance=5e4,e.maxDistance=1/0,e.enableKeys=!1,this.perspectiveControl=e,this.cameraControls.push(e)},e.prototype.createLights=function(){var e=new THREE.AmbientLight(16777215,.65);this.scene.add(e);var t=new THREE.DirectionalLight(16777215,.4);t.color.setHSL(.1,1,.95),t.position.set(1,1.75,0),t.position.multiplyScalar(60),this.scene.add(t)},e.prototype.zoomIn=function(){for(var e=0;e<this.cameraControls.length;e++){var t=this.cameraControls[e];t.zoomIn()}},e.prototype.zoomAway=function(){for(var e=0;e<this.cameraControls.length;e++){var t=this.cameraControls[e];t.zoomOut()}},e.prototype.enabledRotateUp=function(e){for(var t=0;t<this.cameraControls.length;t++){var i=this.cameraControls[t];i.enableRotateUp=e}},e.prototype.enabledRotateLeft=function(e){for(var t=0;t<this.cameraControls.length;t++){var i=this.cameraControls[t];i.enableRotateLeft=e}},e.prototype.backgroundSet=function(e){e=e||15856375,this.renderer&&this.renderer.setClearColor(e)},e.prototype.enabledMapMove=function(e){for(var t=0;t<this.cameraControls.length;t++){var i=this.cameraControls[t];i.enablePan=e}},e.prototype.render=function(){this.curArchite&&this.curArchite.updateBillBoards(this.camera),this.renderer.clear(),this.is3D?(this.renderer.render(this.scene,this.camera),this.renderer.clearDepth(),this.renderer.render(this.labelScene,this.labelCamera)):(this.renderer.render(this.planeScene,this.camera),this.renderer.clearDepth(),this.renderer.render(this.labelScene,this.labelCamera))},e.prototype.enabled3D=function(e){var t=this;t.SelMesh&&(t.SelMesh.material=t.SelMesh.defaultMaterial,t.SelMesh=null),t.SelPlane&&(t.SelPlane.material=t.SelPlane.defaultMaterial,t.SelPlane=null),e?(t.is3D=e,t.curCameraPosition.copy(t.camera.position),t.perspectiveControl.maxPolarAngle=t.maxPolarAngleInit,t.defalutCameraTween.stop(),t.defalutCameraTween.to({x:t.defalutCameraPosition.x,y:t.defalutCameraPosition.y,z:t.defalutCameraPosition.z},500).onUpdate(function(){t.camera.position.copy(this),t.perspectiveControl.update()}),t.defalutCameraTween.start()):(t.defalutCameraPosition.copy(this.camera.position),t.perspectiveTween.stop(),t.perspectiveControlSet.maxPolarAngle=Math.PI/2,t.perspectiveTween.to({maxPolarAngle:0},1e3).onUpdate(function(){t.perspectiveControl.maxPolarAngle=this.maxPolarAngle,t.perspectiveControl.update()}).onComplete(function(){t.is3D=e,t.curArchite&&t.curArchite.display2DPattern()}),t.perspectiveTween.start())},e.prototype.pubPointEnabled=function(e){this.curArchite&&this.curArchite.enabledFloorsPubPoints(e)},e.prototype.funcAreasLabelEnabled=function(e){this.curArchite&&this.curArchite.enabledFloorsLabel(e)},e.prototype.updateMapByArchiteBase=function(e){this.curArchite=e,e&&(IsPC()?this.defalutCameraPosition.set(0,1367,-1269):this.defalutCameraPosition.set(0,2348,-2529),this.camera.position.copy(this.defalutCameraPosition),this.perspectiveControl.update(),this.scene.add(e.floorGround),this.planeScene.add(e.floorGround2D),this.scene.add(e.ArchiteMesh),this.planeScene.add(e.ArchiteMesh2D),this.labelScene.add(e.ArchiteSprite),e.showFloorsMeshByID(e.getDefaultFoolr()),e.enabledFloorsPubPoints(!0),e.enabledFloorsLabel(!0))},e.prototype.resize=function(){this.renderer.setSize(V_WIDTH,V_HEIGHT),this.camera.aspect=V_WIDTH/V_HEIGHT,this.camera.updateProjectionMatrix(),this.labelCamera.left=V_WIDTH/-2,this.labelCamera.right=V_WIDTH/2,this.labelCamera.top=V_HEIGHT/2,this.labelCamera.bottom=V_HEIGHT/-2,this.labelCamera.updateProjectionMatrix()},e.prototype.createMeshSel=function(){var e=this;this.SelEffectTweenAlpha1=new TWEEN.Tween(this.SelMaterial),this.SelEffectTweenAlpha0=new TWEEN.Tween(this.SelMaterial),this.SelEffectTweenAlpha1.to({opacity:1},500),this.SelEffectTweenAlpha0.to({opacity:0},500).onComplete(function(){e.SelEffectTweenAlpha1.start()}),this.SelEffectTweenAlphaPlane1=new TWEEN.Tween(this.SelMaterialPlane),this.SelEffectTweenAlphaPlane0=new TWEEN.Tween(this.SelMaterialPlane),this.SelEffectTweenAlphaPlane1.to({opacity:1},500),this.SelEffectTweenAlphaPlane0.to({opacity:0},500).onComplete(function(){e.SelEffectTweenAlphaPlane1.start()}),this.raycaster=new THREE.Raycaster,this.controlDom.addEventListener("mousedown",function(t){e.meshSelDownPoint.x=t.clientX,e.meshSelDownPoint.y=t.clientY}),this.controlDom.addEventListener("mouseup",function(t){Math.abs(e.meshSelDownPoint.x-t.clientX)>3||Math.abs(e.meshSelDownPoint.y-t.clientY)>3?e.isSel=!1:e.isSel=!0}),this.controlDom.addEventListener("click",function(t){if(e.isSel&&e.curArchite&&e.selectEnabled){if(!e.curArchite.ArchiteMesh)return;e.mousePoint.x=t.clientX/V_WIDTH*2-1,e.mousePoint.y=2*-(t.clientY/V_HEIGHT)+1,e.raycaster.setFromCamera(e.mousePoint,e.camera);var i=[];i=e.is3D?e.raycaster.intersectObjects(e.curArchite.ArchiteMesh.children,!0):e.raycaster.intersectObjects(e.curArchite.ArchiteMesh2D.children,!0),i.length&&e.selMeshHandler(i[0])}})},e.prototype.searchFuncArea=function(e){if(this.curArchite){var t=this.curArchite.search(e);t?this.is3D?this.selMeshHandler({object:t.mesh.children[0]}):this.selMeshHandler({object:t.plane.children[0]}):msg("未找到："+e)}else msg("不存在建筑供查询！")},e.prototype.selMeshHandler=function(e){if(e&&e.object){var t=e.object;this.is3D?(this.SelMesh&&(this.SelMesh.material=this.SelMesh.defaultMaterial,this.SelMesh=null),this.SelMesh=t,t.material=this.SelMaterial,this.SelMaterial.opacity=1,this.SelEffectTweenAlpha0.start()):(this.SelPlane&&(this.SelPlane.material=this.SelPlane.defaultMaterial,this.SelPlane=null),this.SelPlane=t,t.material=this.SelMaterialPlane,this.SelMaterialPlane.opacity=1,this.SelEffectTweenAlphaPlane0.start())}},e}();Rect.prototype.isCollide=function(e){return!(e.br[0]<this.tl[0]||e.tl[0]>this.br[0]||e.br[1]<this.tl[1]||e.tl[1]>this.br[1])};var ArchiteUI=function(){function e(e,t){this.webgl=null,this.uiStyles=null,this.uiStylesStr="",this.domClass="",this.domID="",this.checkBoxContainer=null,this.domContainer=null,this.curArchite=null,this.scaleDomContainer=null,this.createSearch=!1,this.pubPoint=null,this.funcAreaName=null,this.funcAreaSelect=null,this.yAxisRotation=null,this.xAxisRotation=null,this.moveMap=null,this.viewModels=null,this.floorDom=null,this.backgroundColorChange=null,this.webgl=t,this.domContainer=e,this.domID=d3.select(e).attr("id"),this.domClass=d3.select(e).attr("class"),IsPC()?(this.appendUIStyle(".architeScaleContainer{position:absolute;top:1vw;left:1vw;width:3vw;height:6vw;}"),this.appendUIStyle(".scaleBtn{width:100%;height:50%;}"),this.appendUIStyle(".architeSearchDiv{position:absolute;right:1vw;top:1vw;}"),this.appendUIStyle(".architeFloorBtnContainer{position:absolute;right:1vw;top:6vw;width:3vw;}"),this.appendUIStyle(".architeFloorBtn{width:100%;height:3vw;}"),this.appendUIStyle(".architeFloorList{width:100%;}"),this.appendUIStyle(".architeSearchInput{width: 20vw;height:2.6vw;line-height: 2.6vw;}"),this.appendUIStyle(".architeSearchBtn{ width:6vw;height:3vw;}"),this.appendUIStyle(".checkBoxContainer{position:absolute;top:10vw;left:1vw;}"),this.appendUIStyle(".architeSwitchDiv{width:9vw;height:3vw;line-height: 3vw;display:table;}"),this.appendUIStyle(".architeSwitchCheckBox{width:2vw;display: table-cell;vertical-align: middle;}")):(this.appendUIStyle(".architeScaleContainer{position:absolute;top:1vw;left:1vw;width:8vw;height:12vw;}"),this.appendUIStyle(".scaleBtn{width:100%;height:50%;}"),this.appendUIStyle(".architeSearchDiv{position:absolute;right:1vw;top:1vw;}"),this.appendUIStyle(".architeFloorBtnContainer{position:absolute;right:1vw;top:16vw;width:8vw;}"),this.appendUIStyle(".architeFloorBtn{width:100%;height:6vw;}"),this.appendUIStyle(".architeFloorList{width:100%;}"),this.appendUIStyle(".architeSearchInput{width: 24vw;height:4.6vw;line-height: 4.6vw;}"),this.appendUIStyle(".architeSearchBtn{ width:12vw;height:6vw;}"),this.appendUIStyle(".checkBoxContainer{position:absolute;top:18vw;left:1vw;}"),this.appendUIStyle(".architeSwitchDiv{width:25vw;height:7vw;line-height: 3vw;display:table;}"),this.appendUIStyle(".architeSwitchCheckBox{width:4vw;display: table-cell;vertical-align: middle;}")),this.checkBoxContainer=d3.select(e).append("div").attr("class","checkBoxContainer")}return e.prototype.appendUIStyle=function(e){this.uiStyles||(this.uiStyles=d3.select("head").append("style")),this.domID?e+=this.domID+" "+e:this.domClass&&(e+=this.domClass+" "+e),this.uiStylesStr+=e,this.uiStyles.html(this.uiStylesStr)},e.prototype.openScale=function(){if(this.scaleDomContainer)return void console.log("放大缩小按钮已创建！！！");var e=d3.select(this.domContainer).append("div").attr("class","architeScaleContainer");this.scaleDomContainer=e;var t=this;this.createBtn(e,"+","scaleBtn",function(){t.webgl&&t.webgl.zoomIn()}),this.createBtn(e,"-","scaleBtn",function(){t.webgl&&t.webgl.zoomAway()})},e.prototype.createBtn=function(e,t,i,n){n=n||function(){},i=""==i?null:i,i=i||"architeBtn";var o=e.append("button");return o.attr("class",i),o.text(t),o.on("click",function(e){n()}),o},e.prototype.updataUIByArchiteBase=function(e){this.curArchite=e,this.createFloorsBtn(e)},e.prototype.openSearch=function(){if(this.createSearch)return void console.log("搜索已经创建功能已经创建");this.createSearch=!0;var e=this,t=d3.select(this.domContainer).append("div").attr("class","architeSearchDiv"),i=t.append("input").attr("class","architeSearchInput");e.createBtn(t,"搜索","architeSearchBtn",function(){var t=i[0][0].value;return t?""==t?void msg("搜索内容为空！！"):void(e.webgl&&e.webgl.searchFuncArea(t)):void msg("搜索内容为空！！")})},e.prototype.createCheckBox=function(e,t,i){i=i||function(){};var n=this.checkBoxContainer.append("div").attr("class","architeSwitchDiv"),o=(n.append("span").attr("class","architeSwitchName").text(e),n.append("input").attr({class:"architeSwitchCheckBox",type:"checkbox",checked:"",name:"open",title:e}));return n.on("click",function(e){var t=o[0][0].checked;i(t)}),n},e.prototype.showPubPointSwitch=function(){var e=this;this.pubPoint||(this.pubPoint=this.createCheckBox("公共设施",[0,100,0,0],function(t){console.log("公共设施:"+t),e.webgl&&e.webgl.pubPointEnabled(t)}))},e.prototype.showFuncAreaNameSwitch=function(){var e=this;this.funcAreaName||(this.funcAreaName=this.createCheckBox("店铺名称",[0,100,0,0],function(t){console.log("店铺名称:"+t),e.webgl&&e.webgl.funcAreasLabelEnabled(t)}))},e.prototype.showFuncSelectSwitch=function(){var e=this;this.funcAreaSelect||(this.funcAreaSelect=this.createCheckBox("店铺选择",[0,100,0,0],function(t){console.log("店铺选择:"+t),e.webgl&&(e.webgl.selectEnabled=t)}))},e.prototype.showYAxisRotateSwitch=function(){var e=this;this.yAxisRotation||(this.yAxisRotation=this.createCheckBox("左右旋转",[0,100,0,0],function(t){console.log("左右旋转:"+t),e.webgl&&e.webgl.enabledRotateLeft(t)}))},e.prototype.showXAxisRotateSwitch=function(){var e=this;this.xAxisRotation||(this.xAxisRotation=this.createCheckBox("上下旋转",[0,100,0,0],function(t){console.log("上下旋转:"+t),e.webgl&&e.webgl.enabledRotateUp(t)}))},e.prototype.showMoveMapSwitch=function(){var e=this;this.moveMap||(this.moveMap=this.createCheckBox("移动地图",[0,100,0,0],function(t){console.log("移动地图:"+t),e.webgl&&e.webgl.enabledMapMove(t)}))},e.prototype.viewPatternSwitch=function(){var e=this;this.viewModels||(this.viewModels=this.createCheckBox("三维展示",[0,100,0,0],function(t){console.log("三维展示:"+t),e.webgl&&e.webgl.enabled3D(t)}))},e.prototype.createFloorsBtn=function(e){var t=this;if(!t.floorDom){var i=e.oriData.Floors||[];t.floorDom=d3.select(t.domContainer).append("div"),t.floorDom.attr("class","architeFloorBtnContainer");var n=t.floorDom,o=n.append("button").attr("class","architeFloorBtn").text("All");o.on("click",function(e){t.showAllFloors()});var a=n.append("div").attr("class","architeFloorList");a.selectAll("button").remove();a.selectAll("button").data(i).enter().append("button").attr("class","architeFloorBtn").text(function(e){return e.Name||"--"}).on("click",function(e){t.selectFloor(e)})}},e.prototype.selectFloor=function(e){console.log(e);var t=!1;t=!this.webgl.is3D;var i=this.curArchite.showFloorsMeshByID(e._id,t);this.webgl&&this.webgl.lookatYTweento(i.yAxis)},e.prototype.showAllFloors=function(){this.webgl&&this.webgl.enabled3D(!0),this.curArchite&&this.curArchite.showAllFloors()},e.prototype.createBackgroundSet=function(){var e=this;if(!this.backgroundColorChange){var t={left:10,top:450,right:0,bottom:0},i=d3.select(this.domContainer).append("div").style({width:"150px",height:"50px",position:"absolute",left:t.left+"px",top:t.top+"px",right:t.right+"px",bottom:t.bottom+"px"});this.backgroundColorChange=i;var n=(i.append("label").style({width:"75px",height:"30px","font-size":"14px",float:"left","line-height":"30px",color:"white","padding-left":"10px",background:"#5fb878","box-sizing":"border-box","border-radius":"3px"}).text("背景颜色"),i.append("div").attr("class","webgl_backgroundColor").style({float:"left",width:"30px",height:"30px",background:"#f1f2f7",border:"1px solid #5fb878"}));$(".webgl_backgroundColor").colpick({color:"f1f2f7",onSubmit:function(t,i,o,a){n.style("background","#"+i),i="0x"+i,i=Math.floor(i),e.webglBackgroundChange(i)}})}},e.prototype.webglBackgroundChange=function(e){this.webgl&&this.webgl.backgroundSet(e)},e}(),Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,i,n;e=e||{},t=void 0!==e.parent?e.parent:document.body,i=void 0!==e.id?e.id:"oldie",n=Detector.getWebGLErrorMessage(),n.id=i,t.appendChild(n)}};"object"==typeof module&&(module.exports=Detector),!function(e,t){"use strict";var i,n,o={getPath:function(){var e=document.scripts,t=e[e.length-1],i=t.src;if(!t.getAttribute("merge"))return i.substring(0,i.lastIndexOf("/")+1);
}(),enter:function(e){13===e.keyCode&&e.preventDefault()},config:{},end:{},btn:["&#x786E;&#x5B9A;","&#x53D6;&#x6D88;"],type:["dialog","page","iframe","loading","tips"]},a={v:"2.4",ie6:!!e.ActiveXObject&&!e.XMLHttpRequest,index:0,path:o.getPath,config:function(e,t){var n=0;return e=e||{},a.cache=o.config=i.extend(o.config,e),a.path=o.config.path||a.path,"string"==typeof e.extend&&(e.extend=[e.extend]),a.use("skin/layer.css",e.extend&&e.extend.length>0?function i(){var o=e.extend;a.use(o[o[n]?n:n-1],n<o.length?function(){return++n,i}():t)}():t),this},use:function(e,t,n){var o=i("head")[0],e=e.replace(/\s/g,""),r=/\.css$/.test(e),s=document.createElement(r?"link":"script"),l="layui_layer_"+e.replace(/\.|\//g,"");return a.path?(r&&(s.rel="stylesheet"),s[r?"href":"src"]=/^http:\/\//.test(e)?e:a.path+e,s.id=l,i("#"+l)[0]||o.appendChild(s),function e(){(r?1989===parseInt(i("#"+l).css("width")):a[n||l])?function(){t&&t();try{r||o.removeChild(s)}catch(e){}}():setTimeout(e,100)}(),this):void 0},ready:function(e,t){var n="function"==typeof e;return n&&(t=e),a.config(i.extend(o.config,function(){return n?{}:{path:e}}()),t),this},alert:function(e,t,n){var o="function"==typeof t;return o&&(n=t),a.open(i.extend({content:e,yes:n},o?{}:t))},confirm:function(e,t,n,r){var s="function"==typeof t;return s&&(r=n,n=t),a.open(i.extend({content:e,btn:o.btn,yes:n,btn2:r},s?{}:t))},msg:function(e,n,r){var l="function"==typeof n,c=o.config.skin,h=(c?c+" "+c+"-msg":"")||"layui-layer-msg",u=s.anim.length-1;return l&&(r=n),a.open(i.extend({content:e,time:3e3,shade:!1,skin:h,title:!1,closeBtn:!1,btn:!1,end:r},l&&!o.config.skin?{skin:h+" layui-layer-hui",shift:u}:function(){return n=n||{},(-1===n.icon||n.icon===t&&!o.config.skin)&&(n.skin=h+" "+(n.skin||"layui-layer-hui")),n}()))},load:function(e,t){return a.open(i.extend({type:3,icon:e||0,shade:.01},t))},tips:function(e,t,n){return a.open(i.extend({type:4,content:[e,t],closeBtn:!1,time:3e3,shade:!1,fix:!1,maxWidth:210},n))}},r=function(e){var t=this;t.index=++a.index,t.config=i.extend({},t.config,o.config,e),t.creat()};r.pt=r.prototype;var s=["layui-layer",".layui-layer-title",".layui-layer-main",".layui-layer-dialog","layui-layer-iframe","layui-layer-content","layui-layer-btn","layui-layer-close"];s.anim=["layer-anim","layer-anim-01","layer-anim-02","layer-anim-03","layer-anim-04","layer-anim-05","layer-anim-06"],r.pt.config={type:0,shade:.3,fix:!0,move:s[1],title:"&#x4FE1;&#x606F;",offset:"auto",area:"auto",closeBtn:1,time:0,zIndex:19891014,maxWidth:360,shift:0,icon:-1,scrollbar:!0,tips:2},r.pt.vessel=function(e,t){var i=this,n=i.index,a=i.config,r=a.zIndex+n,l="object"==typeof a.title,c=a.maxmin&&(1===a.type||2===a.type),h=a.title?'<div class="layui-layer-title" style="'+(l?a.title[1]:"")+'">'+(l?a.title[0]:a.title)+"</div>":"";return a.zIndex=r,t([a.shade?'<div class="layui-layer-shade" id="layui-layer-shade'+n+'" times="'+n+'" style="'+("z-index:"+(r-1)+"; background-color:"+(a.shade[1]||"#000")+"; opacity:"+(a.shade[0]||a.shade)+"; filter:alpha(opacity="+(100*a.shade[0]||100*a.shade)+");")+'"></div>':"",'<div class="'+s[0]+(" layui-layer-"+o.type[a.type])+(0!=a.type&&2!=a.type||a.shade?"":" layui-layer-border")+" "+(a.skin||"")+'" id="'+s[0]+n+'" type="'+o.type[a.type]+'" times="'+n+'" showtime="'+a.time+'" conType="'+(e?"object":"string")+'" style="z-index: '+r+"; width:"+a.area[0]+";height:"+a.area[1]+(a.fix?"":";position:absolute;")+'">'+(e&&2!=a.type?"":h)+'<div id="'+(a.id||"")+'" class="layui-layer-content'+(0==a.type&&-1!==a.icon?" layui-layer-padding":"")+(3==a.type?" layui-layer-loading"+a.icon:"")+'">'+(0==a.type&&-1!==a.icon?'<i class="layui-layer-ico layui-layer-ico'+a.icon+'"></i>':"")+(1==a.type&&e?"":a.content||"")+'</div><span class="layui-layer-setwin">'+function(){var e=c?'<a class="layui-layer-min" href="javascript:;"><cite></cite></a><a class="layui-layer-ico layui-layer-max" href="javascript:;"></a>':"";return a.closeBtn&&(e+='<a class="layui-layer-ico '+s[7]+" "+s[7]+(a.title?a.closeBtn:4==a.type?"1":"2")+'" href="javascript:;"></a>'),e}()+"</span>"+(a.btn?function(){var e="";"string"==typeof a.btn&&(a.btn=[a.btn]);for(var t=0,i=a.btn.length;i>t;t++)e+='<a class="'+s[6]+t+'">'+a.btn[t]+"</a>";return'<div class="'+s[6]+'">'+e+"</div>"}():"")+"</div>"],h),i},r.pt.creat=function(){var e=this,t=e.config,r=e.index,l=t.content,c="object"==typeof l;if(!i("#"+t.id)[0]){switch("string"==typeof t.area&&(t.area="auto"===t.area?["",""]:[t.area,""]),t.type){case 0:t.btn="btn"in t?t.btn:o.btn[0],a.closeAll("dialog");break;case 2:var l=t.content=c?t.content:[t.content||"http://layer.layui.com","auto"];t.content='<iframe scrolling="'+(t.content[1]||"auto")+'" allowtransparency="true" id="'+s[4]+r+'" name="'+s[4]+r+'" onload="this.className=\'\';" class="layui-layer-load" frameborder="0" src="'+t.content[0]+'"></iframe>';break;case 3:t.title=!1,t.closeBtn=!1,-1===t.icon&&0===t.icon,a.closeAll("loading");break;case 4:c||(t.content=[t.content,"body"]),t.follow=t.content[1],t.content=t.content[0]+'<i class="layui-layer-TipsG"></i>',t.title=!1,t.tips="object"==typeof t.tips?t.tips:[t.tips,!0],t.tipsMore||a.closeAll("tips")}e.vessel(c,function(n,o){i("body").append(n[0]),c?function(){2==t.type||4==t.type?function(){i("body").append(n[1])}():function(){l.parents("."+s[0])[0]||(l.show().addClass("layui-layer-wrap").wrap(n[1]),i("#"+s[0]+r).find("."+s[5]).before(o))}()}():i("body").append(n[1]),e.layero=i("#"+s[0]+r),t.scrollbar||s.html.css("overflow","hidden").attr("layer-full",r)}).auto(r),2==t.type&&a.ie6&&e.layero.find("iframe").attr("src",l[0]),i(document).off("keydown",o.enter).on("keydown",o.enter),e.layero.on("keydown",function(e){i(document).off("keydown",o.enter)}),4==t.type?e.tips():e.offset(),t.fix&&n.on("resize",function(){e.offset(),(/^\d+%$/.test(t.area[0])||/^\d+%$/.test(t.area[1]))&&e.auto(r),4==t.type&&e.tips()}),t.time<=0||setTimeout(function(){a.close(e.index)},t.time),e.move().callback(),s.anim[t.shift]&&e.layero.addClass(s.anim[t.shift])}},r.pt.auto=function(e){function t(e){e=r.find(e),e.height(l[1]-c-h-2*(0|parseFloat(e.css("padding"))))}var o=this,a=o.config,r=i("#"+s[0]+e);""===a.area[0]&&a.maxWidth>0&&(/MSIE 7/.test(navigator.userAgent)&&a.btn&&r.width(r.innerWidth()),r.outerWidth()>a.maxWidth&&r.width(a.maxWidth));var l=[r.innerWidth(),r.innerHeight()],c=r.find(s[1]).outerHeight()||0,h=r.find("."+s[6]).outerHeight()||0;switch(a.type){case 2:t("iframe");break;default:""===a.area[1]?a.fix&&l[1]>=n.height()&&(l[1]=n.height(),t("."+s[5])):t("."+s[5])}return o},r.pt.offset=function(){var e=this,t=e.config,i=e.layero,o=[i.outerWidth(),i.outerHeight()],a="object"==typeof t.offset;e.offsetTop=(n.height()-o[1])/2,e.offsetLeft=(n.width()-o[0])/2,a?(e.offsetTop=t.offset[0],e.offsetLeft=t.offset[1]||e.offsetLeft):"auto"!==t.offset&&(e.offsetTop=t.offset,"rb"===t.offset&&(e.offsetTop=n.height()-o[1],e.offsetLeft=n.width()-o[0])),t.fix||(e.offsetTop=/%$/.test(e.offsetTop)?n.height()*parseFloat(e.offsetTop)/100:parseFloat(e.offsetTop),e.offsetLeft=/%$/.test(e.offsetLeft)?n.width()*parseFloat(e.offsetLeft)/100:parseFloat(e.offsetLeft),e.offsetTop+=n.scrollTop(),e.offsetLeft+=n.scrollLeft()),i.css({top:e.offsetTop,left:e.offsetLeft})},r.pt.tips=function(){var e=this,t=e.config,o=e.layero,a=[o.outerWidth(),o.outerHeight()],r=i(t.follow);r[0]||(r=i("body"));var l={width:r.outerWidth(),height:r.outerHeight(),top:r.offset().top,left:r.offset().left},c=o.find(".layui-layer-TipsG"),h=t.tips[0];t.tips[1]||c.remove(),l.autoLeft=function(){l.left+a[0]-n.width()>0?(l.tipLeft=l.left+l.width-a[0],c.css({right:12,left:"auto"})):l.tipLeft=l.left},l.where=[function(){l.autoLeft(),l.tipTop=l.top-a[1]-10,c.removeClass("layui-layer-TipsB").addClass("layui-layer-TipsT").css("border-right-color",t.tips[1])},function(){l.tipLeft=l.left+l.width+10,l.tipTop=l.top,c.removeClass("layui-layer-TipsL").addClass("layui-layer-TipsR").css("border-bottom-color",t.tips[1])},function(){l.autoLeft(),l.tipTop=l.top+l.height+10,c.removeClass("layui-layer-TipsT").addClass("layui-layer-TipsB").css("border-right-color",t.tips[1])},function(){l.tipLeft=l.left-a[0]-10,l.tipTop=l.top,c.removeClass("layui-layer-TipsR").addClass("layui-layer-TipsL").css("border-bottom-color",t.tips[1])}],l.where[h-1](),1===h?l.top-(n.scrollTop()+a[1]+16)<0&&l.where[2]():2===h?n.width()-(l.left+l.width+a[0]+16)>0||l.where[3]():3===h?l.top-n.scrollTop()+l.height+a[1]+16-n.height()>0&&l.where[0]():4===h&&a[0]+16-l.left>0&&l.where[1](),o.find("."+s[5]).css({"background-color":t.tips[1],"padding-right":t.closeBtn?"30px":""}),o.css({left:l.tipLeft-(t.fix?n.scrollLeft():0),top:l.tipTop-(t.fix?n.scrollTop():0)})},r.pt.move=function(){var e=this,t=e.config,o={setY:0,moveLayer:function(){var e=o.layero,t=parseInt(e.css("margin-left")),i=parseInt(o.move.css("left"));0===t||(i-=t),"fixed"!==e.css("position")&&(i-=e.parent().offset().left,o.setY=0),e.css({left:i,top:parseInt(o.move.css("top"))-o.setY})}},a=e.layero.find(t.move);return t.move&&a.attr("move","ok"),a.css({cursor:t.move?"move":"auto"}),i(t.move).on("mousedown",function(e){if(e.preventDefault(),"ok"===i(this).attr("move")){o.ismove=!0,o.layero=i(this).parents("."+s[0]);var a=o.layero.offset().left,r=o.layero.offset().top,l=o.layero.outerWidth()-6,c=o.layero.outerHeight()-6;i("#layui-layer-moves")[0]||i("body").append('<div id="layui-layer-moves" class="layui-layer-moves" style="left:'+a+"px; top:"+r+"px; width:"+l+"px; height:"+c+'px; z-index:2147483584"></div>'),o.move=i("#layui-layer-moves"),t.moveType&&o.move.css({visibility:"hidden"}),o.moveX=e.pageX-o.move.position().left,o.moveY=e.pageY-o.move.position().top,"fixed"!==o.layero.css("position")||(o.setY=n.scrollTop())}}),i(document).mousemove(function(e){if(o.ismove){var i=e.pageX-o.moveX,a=e.pageY-o.moveY;if(e.preventDefault(),!t.moveOut){o.setY=n.scrollTop();var r=n.width()-o.move.outerWidth(),s=o.setY;0>i&&(i=0),i>r&&(i=r),s>a&&(a=s),a>n.height()-o.move.outerHeight()+o.setY&&(a=n.height()-o.move.outerHeight()+o.setY)}o.move.css({left:i,top:a}),t.moveType&&o.moveLayer(),i=a=r=s=null}}).mouseup(function(){try{o.ismove&&(o.moveLayer(),o.move.remove(),t.moveEnd&&t.moveEnd()),o.ismove=!1}catch(e){o.ismove=!1}}),e},r.pt.callback=function(){function e(){var e=r.cancel&&r.cancel(t.index,n);e===!1||a.close(t.index)}var t=this,n=t.layero,r=t.config;t.openLayer(),r.success&&(2==r.type?n.find("iframe").on("load",function(){r.success(n,t.index)}):r.success(n,t.index)),a.ie6&&t.IE6(n),n.find("."+s[6]).children("a").on("click",function(){var e=i(this).index();if(0===e)r.yes?r.yes(t.index,n):r.btn1?r.btn1(t.index,n):a.close(t.index);else{var o=r["btn"+(e+1)]&&r["btn"+(e+1)](t.index,n);o===!1||a.close(t.index)}}),n.find("."+s[7]).on("click",e),r.shadeClose&&i("#layui-layer-shade"+t.index).on("click",function(){a.close(t.index)}),n.find(".layui-layer-min").on("click",function(){var e=r.min&&r.min(n);e===!1||a.min(t.index,r)}),n.find(".layui-layer-max").on("click",function(){i(this).hasClass("layui-layer-maxmin")?(a.restore(t.index),r.restore&&r.restore(n)):(a.full(t.index,r),setTimeout(function(){r.full&&r.full(n)},100))}),r.end&&(o.end[t.index]=r.end)},o.reselect=function(){i.each(i("select"),function(e,t){var n=i(this);n.parents("."+s[0])[0]||1==n.attr("layer")&&i("."+s[0]).length<1&&n.removeAttr("layer").show(),n=null})},r.pt.IE6=function(e){function t(){e.css({top:a+(o.config.fix?n.scrollTop():0)})}var o=this,a=e.offset().top;t(),n.scroll(t),i("select").each(function(e,t){var n=i(this);n.parents("."+s[0])[0]||"none"===n.css("display")||n.attr({layer:"1"}).hide(),n=null})},r.pt.openLayer=function(){var e=this;a.zIndex=e.config.zIndex,a.setTop=function(e){var t=function(){a.zIndex++,e.css("z-index",a.zIndex+1)};return a.zIndex=parseInt(e[0].style.zIndex),e.on("mousedown",t),a.zIndex}},o.record=function(e){var t=[e.width(),e.height(),e.position().top,e.position().left+parseFloat(e.css("margin-left"))];e.find(".layui-layer-max").addClass("layui-layer-maxmin"),e.attr({area:t})},o.rescollbar=function(e){s.html.attr("layer-full")==e&&(s.html[0].style.removeProperty?s.html[0].style.removeProperty("overflow"):s.html[0].style.removeAttribute("overflow"),s.html.removeAttr("layer-full"))},e.layer=a,a.getChildFrame=function(e,t){return t=t||i("."+s[4]).attr("times"),i("#"+s[0]+t).find("iframe").contents().find(e)},a.getFrameIndex=function(e){return i("#"+e).parents("."+s[4]).attr("times")},a.iframeAuto=function(e){if(e){var t=a.getChildFrame("html",e).outerHeight(),n=i("#"+s[0]+e),o=n.find(s[1]).outerHeight()||0,r=n.find("."+s[6]).outerHeight()||0;n.css({height:t+o+r}),n.find("iframe").css({height:t})}},a.iframeSrc=function(e,t){i("#"+s[0]+e).find("iframe").attr("src",t)},a.style=function(e,t){var n=i("#"+s[0]+e),a=n.attr("type"),r=n.find(s[1]).outerHeight()||0,l=n.find("."+s[6]).outerHeight()||0;(a===o.type[1]||a===o.type[2])&&(n.css(t),a===o.type[2]&&n.find("iframe").css({height:parseFloat(t.height)-r-l}))},a.min=function(e,t){var n=i("#"+s[0]+e),r=n.find(s[1]).outerHeight()||0;o.record(n),a.style(e,{width:180,height:r,overflow:"hidden"}),n.find(".layui-layer-min").hide(),"page"===n.attr("type")&&n.find(s[4]).hide(),o.rescollbar(e)},a.restore=function(e){var t=i("#"+s[0]+e),n=t.attr("area").split(",");t.attr("type"),a.style(e,{width:parseFloat(n[0]),height:parseFloat(n[1]),top:parseFloat(n[2]),left:parseFloat(n[3]),overflow:"visible"}),t.find(".layui-layer-max").removeClass("layui-layer-maxmin"),t.find(".layui-layer-min").show(),"page"===t.attr("type")&&t.find(s[4]).show(),o.rescollbar(e)},a.full=function(e){var t,r=i("#"+s[0]+e);o.record(r),s.html.attr("layer-full")||s.html.css("overflow","hidden").attr("layer-full",e),clearTimeout(t),t=setTimeout(function(){var t="fixed"===r.css("position");a.style(e,{top:t?0:n.scrollTop(),left:t?0:n.scrollLeft(),width:n.width(),height:n.height()}),r.find(".layui-layer-min").hide()},100)},a.title=function(e,t){var n=i("#"+s[0]+(t||a.index)).find(s[1]);n.html(e)},a.close=function(e){var t=i("#"+s[0]+e),n=t.attr("type");if(t[0]){if(n===o.type[1]&&"object"===t.attr("conType")){t.children(":not(."+s[5]+")").remove();for(var r=0;2>r;r++)t.find(".layui-layer-wrap").unwrap().hide()}else{if(n===o.type[2])try{var l=i("#"+s[4]+e)[0];l.contentWindow.document.write(""),l.contentWindow.close(),t.find("."+s[5])[0].removeChild(l)}catch(e){}t[0].innerHTML="",t.remove()}i("#layui-layer-moves, #layui-layer-shade"+e).remove(),a.ie6&&o.reselect(),o.rescollbar(e),i(document).off("keydown",o.enter),"function"==typeof o.end[e]&&o.end[e](),delete o.end[e]}},a.closeAll=function(e){i.each(i("."+s[0]),function(){var t=i(this),n=e?t.attr("type")===e:1;n&&a.close(t.attr("times")),n=null})};var l=a.cache||{},c=function(e){return l.skin?" "+l.skin+" "+l.skin+"-"+e:""};a.prompt=function(e,t){e=e||{},"function"==typeof e&&(t=e);var n,o=2==e.formType?'<textarea class="layui-layer-input">'+(e.value||"")+"</textarea>":function(){return'<input type="'+(1==e.formType?"password":"text")+'" class="layui-layer-input" value="'+(e.value||"")+'">'}();return a.open(i.extend({btn:["&#x786E;&#x5B9A;","&#x53D6;&#x6D88;"],content:o,skin:"layui-layer-prompt"+c("prompt"),success:function(e){n=e.find(".layui-layer-input"),n.focus()},yes:function(i){var o=n.val();""===o?n.focus():o.length>(e.maxlength||500)?a.tips("&#x6700;&#x591A;&#x8F93;&#x5165;"+(e.maxlength||500)+"&#x4E2A;&#x5B57;&#x6570;",n,{tips:1}):t&&t(o,i,n)}},e))},a.tab=function(e){e=e||{};var t=e.tab||{};return a.open(i.extend({type:1,skin:"layui-layer-tab"+c("tab"),title:function(){var e=t.length,i=1,n="";if(e>0)for(n='<span class="layui-layer-tabnow">'+t[0].title+"</span>";e>i;i++)n+="<span>"+t[i].title+"</span>";return n}(),content:'<ul class="layui-layer-tabmain">'+function(){var e=t.length,i=1,n="";if(e>0)for(n='<li class="layui-layer-tabli xubox_tab_layer">'+(t[0].content||"no content")+"</li>";e>i;i++)n+='<li class="layui-layer-tabli">'+(t[i].content||"no  content")+"</li>";return n}()+"</ul>",success:function(t){var n=t.find(".layui-layer-title").children(),o=t.find(".layui-layer-tabmain").children();n.on("mousedown",function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0;var n=i(this),a=n.index();n.addClass("layui-layer-tabnow").siblings().removeClass("layui-layer-tabnow"),o.eq(a).show().siblings().hide(),"function"==typeof e.change&&e.change(a)})}},e))},a.photos=function(t,n,o){function r(e,t,i){var n=new Image;return n.src=e,n.complete?t(n):(n.onload=function(){n.onload=null,t(n)},void(n.onerror=function(e){n.onerror=null,i(e)}))}var s={};if(t=t||{},t.photos){var l=t.photos.constructor===Object,h=l?t.photos:{},u=h.data||[],p=h.start||0;if(s.imgIndex=(0|p)+1,t.img=t.img||"img",l){if(0===u.length)return a.msg("&#x6CA1;&#x6709;&#x56FE;&#x7247;")}else{var d=i(t.photos),f=function(){u=[],d.find(t.img).each(function(e){var t=i(this);t.attr("layer-index",e),u.push({alt:t.attr("alt"),pid:t.attr("layer-pid"),src:t.attr("layer-src")||t.attr("src"),thumb:t.attr("src")})})};if(f(),0===u.length)return;if(n||d.on("click",t.img,function(){var e=i(this),n=e.attr("layer-index");a.photos(i.extend(t,{photos:{start:n,data:u,tab:t.tab},full:t.full}),!0),f()}),!n)return}s.imgprev=function(e){s.imgIndex--,s.imgIndex<1&&(s.imgIndex=u.length),s.tabimg(e)},s.imgnext=function(e,t){s.imgIndex++,s.imgIndex>u.length&&(s.imgIndex=1,t)||s.tabimg(e)},s.keyup=function(e){if(!s.end){var t=e.keyCode;e.preventDefault(),37===t?s.imgprev(!0):39===t?s.imgnext(!0):27===t&&a.close(s.index)}},s.tabimg=function(e){u.length<=1||(h.start=s.imgIndex-1,a.close(s.index),a.photos(t,!0,e))},s.event=function(){s.bigimg.hover(function(){s.imgsee.show()},function(){s.imgsee.hide()}),s.bigimg.find(".layui-layer-imgprev").on("click",function(e){e.preventDefault(),s.imgprev()}),s.bigimg.find(".layui-layer-imgnext").on("click",function(e){e.preventDefault(),s.imgnext()}),i(document).on("keyup",s.keyup)},s.loadi=a.load(1,{shade:!("shade"in t)&&.9,scrollbar:!1}),r(u[p].src,function(n){a.close(s.loadi),s.index=a.open(i.extend({type:1,area:function(){var o=[n.width,n.height],a=[i(e).width()-50,i(e).height()-50];return!t.full&&o[0]>a[0]&&(o[0]=a[0],o[1]=o[0]*n.height/n.width),[o[0]+"px",o[1]+"px"]}(),title:!1,shade:.9,shadeClose:!0,closeBtn:!1,move:".layui-layer-phimg img",moveType:1,scrollbar:!1,moveOut:!0,shift:5*Math.random()|0,skin:"layui-layer-photos"+c("photos"),content:'<div class="layui-layer-phimg"><img src="'+u[p].src+'" alt="'+(u[p].alt||"")+'" layer-pid="'+u[p].pid+'"><div class="layui-layer-imgsee">'+(u.length>1?'<span class="layui-layer-imguide"><a href="javascript:;" class="layui-layer-iconext layui-layer-imgprev"></a><a href="javascript:;" class="layui-layer-iconext layui-layer-imgnext"></a></span>':"")+'<div class="layui-layer-imgbar" style="display:'+(o?"block":"")+'"><span class="layui-layer-imgtit"><a href="javascript:;">'+(u[p].alt||"")+"</a><em>"+s.imgIndex+"/"+u.length+"</em></span></div></div></div>",success:function(e,i){s.bigimg=e.find(".layui-layer-phimg"),s.imgsee=e.find(".layui-layer-imguide,.layui-layer-imgbar"),s.event(e),t.tab&&t.tab(u[p],e)},end:function(){s.end=!0,i(document).off("keyup",s.keyup)}},t))},function(){a.close(s.loadi),a.msg("&#x5F53;&#x524D;&#x56FE;&#x7247;&#x5730;&#x5740;&#x5F02;&#x5E38;<br>&#x662F;&#x5426;&#x7EE7;&#x7EED;&#x67E5;&#x770B;&#x4E0B;&#x4E00;&#x5F20;&#xFF1F;",{time:3e4,btn:["&#x4E0B;&#x4E00;&#x5F20;","&#x4E0D;&#x770B;&#x4E86;"],yes:function(){u.length>1&&s.imgnext(!0,!0)}})})}},o.run=function(){i=jQuery,n=i(e),s.html=i("html"),a.open=function(e){var t=new r(e);return t.index}},"function"==typeof define?define(function(){return o.run(),a}):function(){o.run(),a.use("skin/layer.css")}()}(window),THREE.OrbitControls=function(e,t){function i(){return 2*Math.PI/60/60*F.autoRotateSpeed}function n(){return Math.pow(.95,F.zoomSpeed)}function o(e){F.enableRotateLeft&&(z.theta-=e)}function a(e){F.enableRotateUp&&(z.phi-=e)}function r(e){F.object instanceof THREE.PerspectiveCamera?N/=e:F.object instanceof THREE.OrthographicCamera?(F.object.zoom=Math.max(F.minZoom,Math.min(F.maxZoom,F.object.zoom*e)),F.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),F.enableZoom=!1)}function s(e){F.object instanceof THREE.PerspectiveCamera?N*=e:F.object instanceof THREE.OrthographicCamera?(F.object.zoom=Math.max(F.minZoom,Math.min(F.maxZoom,F.object.zoom/e)),F.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),F.enableZoom=!1)}function l(e){V.set(e.clientX,e.clientY)}function c(e){$.set(e.clientX,e.clientY)}function h(e){X.set(e.clientX,e.clientY)}function u(e){Y.set(e.clientX,e.clientY),Z.subVectors(Y,V);var t=F.domElement===document?F.domElement.body:F.domElement;o(2*Math.PI*Z.x/t.clientWidth*F.rotateSpeed),a(2*Math.PI*Z.y/t.clientHeight*F.rotateSpeed),V.copy(Y),F.update()}function p(e){Q.set(e.clientX,e.clientY),J.subVectors(Q,$),J.y>0?r(n()):J.y<0&&s(n()),$.copy(Q),F.update()}function d(e){K.set(e.clientX,e.clientY),q.subVectors(K,X),ie(q.x,q.y),X.copy(K),F.update()}function f(e){}function m(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?s(n()):t<0&&r(n()),F.update()}function y(e){switch(e.keyCode){case F.keys.UP:ie(0,F.keyPanSpeed),F.update();break;case F.keys.BOTTOM:ie(0,-F.keyPanSpeed),F.update();break;case F.keys.LEFT:ie(F.keyPanSpeed,0),F.update();break;case F.keys.RIGHT:ie(-F.keyPanSpeed,0),F.update()}}function b(e){V.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);$.set(0,n)}function v(e){X.set(e.touches[0].pageX,e.touches[0].pageY)}function w(e){Y.set(e.touches[0].pageX,e.touches[0].pageY),Z.subVectors(Y,V);var t=F.domElement===document?F.domElement.body:F.domElement;o(2*Math.PI*Z.x/t.clientWidth*F.rotateSpeed),a(2*Math.PI*Z.y/t.clientHeight*F.rotateSpeed),V.copy(Y),F.update()}function E(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+i*i);Q.set(0,o),J.subVectors(Q,$),J.y>0?s(n()):J.y<0&&r(n()),$.copy(Q),F.update()}function x(e){K.set(e.touches[0].pageX,e.touches[0].pageY),q.subVectors(K,X),ie(q.x,q.y),X.copy(K),F.update()}function T(e){}function A(e){if(F.enabled!==!1){if(e.preventDefault(),e.button===F.mouseButtons.PAN){if(F.enableRotate===!1)return;l(e),_=j.ROTATE}else if(e.button===F.mouseButtons.ZOOM){if(F.enableZoom===!1)return;c(e),_=j.DOLLY}else if(e.button===F.mouseButtons.ORBIT){if(F.enablePan===!1)return;h(e),_=j.PAN}_!==j.NONE&&(document.addEventListener("mousemove",S,!1),document.addEventListener("mouseup",D,!1),document.addEventListener("mouseout",D,!1),F.dispatchEvent(I))}}function S(e){if(F.enabled!==!1)if(e.preventDefault(),_===j.ROTATE){if(F.enableRotate===!1)return;u(e)}else if(_===j.DOLLY){if(F.enableZoom===!1)return;p(e)}else if(_===j.PAN){if(F.enablePan===!1)return;d(e)}}function D(e){F.enabled!==!1&&(f(e),document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",D,!1),document.removeEventListener("mouseout",D,!1),F.dispatchEvent(O),_=j.NONE)}function C(e){F.enabled===!1||F.enableZoom===!1||_!==j.NONE&&_!==j.ROTATE||(e.preventDefault(),e.stopPropagation(),m(e),F.dispatchEvent(I),F.dispatchEvent(O))}function P(e){F.enabled!==!1&&F.enableKeys!==!1&&F.enablePan!==!1&&y(e)}function M(e){if(F.enabled!==!1){switch(e.touches.length){case 1:if(F.enablePan===!1)return;v(e),_=j.TOUCH_PAN;break;case 2:if(F.enableZoom===!1)return;g(e),_=j.TOUCH_DOLLY;break;case 3:if(F.enableRotate===!1)return;b(e),_=j.TOUCH_ROTATE;break;default:_=j.NONE}_!==j.NONE&&F.dispatchEvent(I)}}function H(e){if(F.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(F.enablePan===!1)return;if(_!==j.TOUCH_PAN)return;x(e);break;case 2:if(F.enableZoom===!1)return;if(_!==j.TOUCH_DOLLY)return;E(e);break;case 3:if(F.enableRotate===!1)return;if(_!==j.TOUCH_ROTATE)return;w(e);break;default:_=j.NONE}}function R(e){F.enabled!==!1&&(T(e),F.dispatchEvent(O),_=j.NONE)}function L(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.enableRotateUp=!0,this.enableRotateLeft=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return phi},this.getAzimuthalAngle=function(){return theta},this.reset=function(){F.target.copy(F.target0),F.object.position.copy(F.position0),F.object.zoom=F.zoom0,F.object.updateProjectionMatrix(),F.dispatchEvent(k),F.update(),_=j.NONE},this.update=function(){var t=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=n.clone().inverse(),r=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=F.object.position;return t.copy(e).sub(F.target),t.applyQuaternion(n),G.setFromVector3(t),F.autoRotate&&_===j.NONE&&o(i()),G.theta+=z.theta,G.phi+=z.phi,G.theta=Math.max(F.minAzimuthAngle,Math.min(F.maxAzimuthAngle,G.theta)),G.phi=Math.max(F.minPolarAngle,Math.min(F.maxPolarAngle,G.phi)),G.makeSafe(),G.radius*=N,G.radius=Math.max(F.minDistance,Math.min(F.maxDistance,G.radius)),F.target.add(U),t.setFromSpherical(G),t.applyQuaternion(a),e.copy(F.target).add(t),F.object.lookAt(F.target),F.enableDamping===!0?(z.theta*=1-F.dampingFactor,z.phi*=1-F.dampingFactor):z.set(0,0,0),N=1,U.set(0,0,0),!!(W||r.distanceToSquared(F.object.position)>B||8*(1-s.dot(F.object.quaternion))>B)&&(F.dispatchEvent(k),r.copy(F.object.position),s.copy(F.object.quaternion),W=!1,!0)}}(),this.dispose=function(){F.domElement.removeEventListener("contextmenu",L,!1),F.domElement.removeEventListener("mousedown",A,!1),F.domElement.removeEventListener("mousewheel",C,!1),F.domElement.removeEventListener("MozMousePixelScroll",C,!1),F.domElement.removeEventListener("touchstart",M,!1),F.domElement.removeEventListener("touchend",R,!1),F.domElement.removeEventListener("touchmove",H,!1),document.removeEventListener("mousemove",S,!1),document.removeEventListener("mouseup",D,!1),document.removeEventListener("mouseout",D,!1),window.removeEventListener("keydown",P,!1)};var F=this,k={type:"change"},I={type:"start"},O={type:"end"},j={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},_=j.NONE,B=1e-6,G=new THREE.Spherical,z=new THREE.Spherical;this.curSpherical=G,this.deltaSpherical=z;var N=1,U=new THREE.Vector3,W=!1,V=new THREE.Vector2,Y=new THREE.Vector2,Z=new THREE.Vector2,X=new THREE.Vector2,K=new THREE.Vector2,q=new THREE.Vector2,$=new THREE.Vector2,Q=new THREE.Vector2,J=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),U.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,i){e.setFromMatrixColumn(i,1),e.multiplyScalar(t),U.add(e)}}(),ie=function(){var e=new THREE.Vector3;return function(t,i){var n=F.domElement===document?F.domElement.body:F.domElement;if(F.object instanceof THREE.PerspectiveCamera){var o=F.object.position;e.copy(o).sub(F.target);var a=e.length();a*=Math.tan(F.object.fov/2*Math.PI/180),ee(2*t*a/n.clientHeight,F.object.matrix),te(2*i*a/n.clientHeight,F.object.matrix)}else F.object instanceof THREE.OrthographicCamera?(ee(t*(F.object.right-F.object.left)/F.object.zoom/n.clientWidth,F.object.matrix),te(i*(F.object.top-F.object.bottom)/F.object.zoom/n.clientHeight,F.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),F.enablePan=!1)}}(),ne={persScale:1,orthZoom:1},oe=new TWEEN.Tween(ne);this.zoomIn=function(){var e=n();if(F.object instanceof THREE.PerspectiveCamera){var t=N*e;ne.persScale=N,oe.to({persScale:t},300),oe.onUpdate(function(){N=this.persScale,F.update()}),oe.start()}else if(F.object instanceof THREE.OrthographicCamera){F.object.zoom=Math.max(F.minZoom,Math.min(F.maxZoom,F.object.zoom/e)),F.object.updateProjectionMatrix(),W=!0;var i=Math.max(F.minZoom,Math.min(F.maxZoom,F.object.zoom/e));ne.orthZoom=F.object.zoom,oe.to({orthZoom:i},300),oe.onUpdate(function(){F.object.zoom==this.orthZoom,F.object.updateProjectionMatrix(),W=!0,F.update()}),oe.start()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),F.enableZoom=!1},this.zoomOut=function(){var e=n();if(F.object instanceof THREE.PerspectiveCamera){var t=N/e;ne.persScale=N,oe.to({persScale:t},300),oe.onUpdate(function(){N=this.persScale,F.update()}),oe.start()}else if(F.object instanceof THREE.OrthographicCamera){var i=Math.max(F.minZoom,Math.min(F.maxZoom,F.object.zoom*dollyScale));ne.orthZoom=F.object.zoom,oe.to({orthZoom:i},300),oe.onUpdate(function(){F.object.zoom==this.orthZoom,F.object.updateProjectionMatrix(),W=!0,F.update()}),oe.start()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),F.enableZoom=!1},F.domElement.addEventListener("contextmenu",L,!1),F.domElement.addEventListener("mousedown",A,!1),F.domElement.addEventListener("mousewheel",C,!1),F.domElement.addEventListener("MozMousePixelScroll",C,!1),F.domElement.addEventListener("touchstart",M,!1),F.domElement.addEventListener("touchend",R,!1),F.domElement.addEventListener("touchmove",H,!1),window.addEventListener("keydown",P,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}});